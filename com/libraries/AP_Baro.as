package com.libraries {
	import com.libraries.Location;
	import com.Sim.Clock;

	public class AP_Baro extends Location{
		private static var instance			:AP_Baro = null;

		public var scaleArray:Array;

		public var index:Number = 0;
		public var l:Number = 0;

		public var _copter_loc:Location;
		public var enable_noise:Boolean;
		public var altitude:int = 0;

		private var delay_array:Array;
		private var obj0:Location;
		private var obj1:Location;
		private var obj2:Location;
		private var obj3:Location;
		private var obj4:Location;
		private var obj5:Location;
		private var obj6:Location;
		private var obj7:Location;
		private var obj8:Location;
		private var obj9:Location;
		private var obj10:Location;

		private var pointer:int;
		private var max_delay:int = 8;
		private var _last_update:int = 0;
		public var clock:Clock;
		//private var altitude:int = 0;

		public function AP_Baro() {
			clock		= Clock.getInstance();
			scaleArray = new Array(-5,-14,-14,-14,-14,-14,-23,-31,-40,-49,-49,-49,-40,-49,-58,-75,-75,-75,-58,-49,-31,-14,-14,-14,-31,-40,-40,-49,-40,-40,-31,-31,-31,-31,-40,-40,-40,-49,-31,-23,-14,-14,-23,-31,-23,-23,-58,-66,-75,-84,-102,-102,-66,-40,-14,13,21,21,21,21,13,4,13,30,30,30,30,57,57,48,57,65,57,39,30,21,21,13,21,21,30,39,39,30,30,21,4,-5,-23,-31,-49,-49,-40,-40,-31,-23,-14,-31,-31,-31,-31,-23,-14,4,21,30,30,21,13,13,4,-14,-14,-5,-5,4,-5,-5,-5,-23,-31,-31,-31,-14,-5,4,13,4,4,4,13,13,4,4,13,-5,-23,-31,-14,-23,-23,-14,-5,21,30,48,48,48,39,39,39,30,39,48,39,30,30,30,30,21,13,21,13,13,13,30,13,-5,-14,-31,-49,-58,-49,-31,-23,-14,-5,4,13,21,30,21,21,21,13,13,4,21,21,21,30,21,21,13,13,13,13,21,21,21,21,4,4,4,-5,-23,-31,-14,-23,-40,-40,-31,-23,-5,13,30,48,39,30,21,13,4,13,21,30,30,30,39,30,21,21,13,-5,-31,-40,-49,-58,-49,-40,-14,-14,-14,-14,-31,-31,-40,-49,-49,-58,-58,-58,-58,-58,-58,-49,-49,-49,-40,-40,-31,-23,-14,-5,4,21,30,21,30,21,13,-5,-31,-40,-66,-75,-84,-84,-66,-58,-31,-14,4,13,39,57,57,48,39,30,4,-23,-31,-31,-14,-5,13,13,13,4,-14,-23,-31,-23,-14,-5,4,4,-14,-31,-49,-58,-75,-75,-66,-66,-58,-58,-49,-40,-40,-40,-40,-23,-23,-14,-5,4,4,4,-5,-14,-5,13,30,57,74,74,57,48,30,13,-5,4,4,4,13,4,4,-14,-23,-31,-40,-49,-40,-31,-31,-40,-31,-23,-49,-58,-49,-31,-23,-5,21,39,30,21,13,4,-31,-40,-58,-58,-66,-75,-49,-31,-14,-5,-14,-23,-23,-40,-58,-66,-58,-49,-40,-31,-23,-14,-5,-14,-14,-23,-14,-14,-14,-23,-23,-23,-23,-31,-31,-40,-31,-40,-40,-40,-49,-49,-58,-58,-58,-58,-49,-31,-14,-5,-5,4,4,-5,-14,-23,-31,-23,-31,-31,-23,-5,4,4,13,4,-23,-49,-66,-84,-102,-84,-49,-23,-5,13,13,4,-5,-5,-14,-23,-14,4,13,13,21,39,39,30,30,39,48,39,39,39,30,13,13,21,30,39,48,57,57,39,30,4,-14,-40,-40,-14,4,30,57,65,48,48,30,13,-5,4,13,4,4,39,48,83,100,117,126,100,92,65,57,39,30,48,39,30,30,39,39,48,57,48,39,30,21,13,13,13,21,21,21,30,30,57,57,65,48,13,-14,-40,-75,-110,-102,-84,-66,-49,-40,-14,-23,-14,-14,-31,-40,-40,-40,-58,-75,-66,-75,-75,-58,-40,-31,-31,-5,4,13,13,21,30,21,13,-5,-14,-31,-49,-58,-49,-40,-31,-14,-5,-5,-14,-14,-23,-31,-40,-31,-31,-31,-23,-14,4,13,21,30,21,30,30,21,13,30,57,57,74,74,74,65,48,30,13,4,4,-14,-23,-40,-31,-31,-14,-5,-5,4,4,4,4,4,13,21,21,30,21,21,21,21,21,4,-5,-14,-23,-31,-23,-14,4,13,21,21,21,21,21,21,30,30,39,39,39,39,48,57,57,57,48,21,4,-14,-31,-58,-49,-40,-49,-49,-40,-23,-5,4,21,39,48,57,57,57,57,57,39,30,21,13,4,4,13,13,21,21,21,30,30,21,21,13,13,4,-14,-23,-31,-31,-31,-31,-23,-14,-5,4,-5,-14,-23,-31,-31,-31,-23,-14,-5,13,4,-14,-23,-23,-31,-31,-23,-5,13,21,21,30,30,30,21,-5,-23,-49,-58,-58,-66,-49,-23,-14,-14,-5,4,4,-5,4,13,4,-5,-5,-14,-14,-5,-5,13,21,30,39,48,48,48,21,21,13,-5,-23,-23,-14,4,13,30,39,30,39,30,30,21,13,4,-5,-23,-40,-49,-58,-66,-66,-66,-49,-23,-14,4,13,4,4,-5,-5,13,30,48,57,65,65,48,30,13,4,-14,-5,-5,4,4,4,4,-5,-14,-14,13,30,39,65,83,92,83,74,83,65,39,30,13,4,-5,-31,-49,-66,-84,-93,-93,-75,-40,-5,21,13,-5,-31,-49,-66,-75,-58,-40,-23,-14,-5,4,13,13,13,-5,-23,-58,-66,-75,-93,-84,-84,-66,-66,-75,-75,-75,-75,-66,-49,-40,-23,-14,-5,4,13,21,21,21,13,-5,-14,-14,-14,-5,-5,4,4,4,4,-5,4,-5,-5,-14,-31,-40,-58,-66,-75,-66,-58,-58,-49,-49,-49,-49,-58,-58,-49,-40,-40,-31,-31,-23,-23,-23,-14,-14,-23,-40,-58,-84,-102,-110,-102,-75,-58,-40,-31,-23,-23,-31,-31,-31,-23,-23,-14,-14,-23,-31,-40,-58,-84,-93,-84,-75,-75,-49,-23,-14,4,13,13,4,-5,-14,-31,-49,-49,-40,-23,-14,-14,4,21,21,30,39,48,39,30,39,39,30,21,21,21,21,4,-5,-14,-31,-49,-58,-66,-49,-49,-40,-49,-58,-66,-75,-93,-110,-128,-146,-146,-146,-119,-102,-75,-58,-49,-31,-31,-31,-23,-14,-14,-14,-23,-23,-31,-49,-49,-58,-66,-66,-66,-58,-58,-58,-49,-58,-66,-75,-84,-84,-84,-66,-66,-49,-31,-31,-31,-49,-40,-49,-58,-49,-49,-23,-23,-31,-31,-31,-31,-31,-31,-31,-14,-14,-5,-14,-14,-23,-31,-31,-40,-31,-23,-14,-14,-14,-5,-5,4,4,4,-14,-23,-31,-40,-31,-31,-23,-5,4,-5,-23,-31,-40,-49,-66,-84,-84,-75,-84,-84,-84,-66,-58,-49,-58,-66,-66,-75,-93,-93,-75,-66,-58,-49,-66,-75,-84,-93,-93,-102,-93,-84,-84,-84,-66,-49,-31,-49,-66,-66,-66,-75,-84,-58,-49,-49,-58,-58,-66,-58,-58,-58,-66,-66,-66,-75,-58,-58,-49,-31,-31,-5,4,13,21,13,21,13,13,4,13,4,4,-5,-14,-23,-31,-40,-49,-49,-40,-40,-31,-23,-23,-40,-49,-49,-58,-84,-75,-75,-84,-84,-84,-66,-58,-40,-23,-14,-14,-14,-14,-14,-14,-14,-5,4,4,-5,-14,-31,-31,-49,-49,-40,-31,-14,-5,-14,-31,-49,-66,-75,-93,-84,-66,-58,-49,-49,-40,-31,-31,-31,-49,-40,-40,-49,-58,-75,-49,-49,-49,-49,-40,-14,-5,-5,13,13,13,-5,-14,-14,-31,-40,-49,-31,-31,-49,-40,-31,-23,-14,-14,-14,-5,-5,-14,-14,-14,-14,-23,-23,-14,-14,-14,-5,4,-14,-40,-49,-58,-66,-75,-66,-58,-58,-58,-58,-58,-49,-49,-49,-58,-49,-58,-75,-84,-93,-93,-84,-84,-75,-66,-49,-40,-31,-23,-23,-14,-5,-5,-5,-31,-31,-14,-23,-31,-31,-5,-5,-14,-14,-23,-31,-40,-40,-31,-23,-14,-5,21,30,30,39,48,48,48,21,4,-23,-49,-66,-75,-75,-58,-49,-40,-31,-49,-49,-58,-66,-66,-58,-49,-40,-31,-31,-40,-40,-40,-40,-49,-49,-40,-49,-58,-58,-58,-49,-40,-23,4,13,21,39,48,39,30,30,21,21,-5,4,-5,-5,-5,-14,13,-5,4,4,13,21,4,30,30,21,21,30,21,4,-5,4,-5,-5,4,13,4,-5);
			l = scaleArray.length;


			obj0 = new Location();
			obj1 = new Location();
			obj2 = new Location();
			obj3 = new Location();
			obj4 = new Location();
			obj5 = new Location();
			obj6 = new Location();
			obj7 = new Location();
			obj8 = new Location();
			obj9 = new Location();
			obj10 = new Location();
			delay_array = [obj0, obj1, obj2, obj3, obj4, obj5, obj6, obj7, obj8, obj9, obj10];
			pointer = 0;
		}

		//AP_Baro.getInstance();
		static public function getInstance():AP_Baro
		{
			if (instance == null)
				instance = new AP_Baro();
			return instance;
		}

		public function set_location(c:Location):void
		{
			_copter_loc = c;
		}

		public function init():void
		{
			for(var i:int = 0; i < delay_array.length; i++){
				delay_array[i].alt = _copter_loc.alt;
			}
			index = 0;
			altitude = _copter_loc.alt;
		}

		// get current altitude in meters relative to altitude at the time
		// of the last calibrate() call
		public function get_altitude():Number
		{
			return Number(altitude) / 100;
		}
		public function get_altitude_cm():int
		{
			return altitude;
		}

	    // get last time sample was taken
		public function get_last_update():int
		{
			return _last_update;
		}

		public function read():Number
		{
			_last_update = clock.millis();
        	pointer++
        	if (pointer >= max_delay)
        		pointer = 0;

        	// store current copter loc into the Delay Array
			delay_array[pointer].alt = _copter_loc.alt;

			var old_pointer:int = (pointer + 1) % max_delay;

			altitude  = delay_array[old_pointer].alt;

			index++;

			if (index >= l)
				index = 0;

			if(enable_noise)
				altitude += scaleArray[index]/2;

			return altitude;
		}


	}
}




